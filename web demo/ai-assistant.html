<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>AI Assistant | QuantAI</title>
    
    <!-- Fonts and Icons -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- CSS -->
    <link href="css/tabler.min.css" rel="stylesheet">
    <link href="css/theme.css" rel="stylesheet">
    <link href="css/style.css" rel="stylesheet">
    
    <style>
        /* AI Assistant Specific Styles */
        .ai-header {
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.1) 0%, rgba(5, 150, 105, 0.1) 100%);
            border: 1px solid rgba(16, 185, 129, 0.2);
            border-radius: 16px;
            padding: 2rem;
            margin-bottom: 2rem;
            display: flex;
            align-items: center;
            gap: 1.5rem;
        }
        
        .ai-avatar {
            width: 80px;
            height: 80px;
            border-radius: 20px;
            background: linear-gradient(135deg, #10b981, #34d399);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            color: white;
        }
        
        .ai-info h1 {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
            color: var(--text-primary);
        }
        
        .ai-info p {
            color: var(--text-secondary);
            font-size: 1rem;
        }
        
        /* Chat Interface */
        .chat-container {
            display: grid;
            grid-template-columns: 1fr 2fr;
            gap: 1.5rem;
            margin-bottom: 2rem;
        }
        
        @media (max-width: 1200px) {
            .chat-container {
                grid-template-columns: 1fr;
            }
        }
        
        /* Quick Questions Panel */
        .quick-questions {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }
        
        .question-card {
            background: var(--card-background);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .question-card:hover {
            background: var(--hover-color);
            border-color: var(--primary-color);
            transform: translateX(5px);
        }
        
        .question-icon {
            width: 40px;
            height: 40px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 0.75rem;
        }
        
        .question-title {
            font-weight: 600;
            margin-bottom: 0.25rem;
            color: var(--text-primary);
        }
        
        .question-desc {
            color: var(--text-secondary);
            font-size: 0.875rem;
        }
        
        /* Chat Area */
        .chat-area {
            background: var(--card-background);
            border: 1px solid var(--border-color);
            border-radius: 16px;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            height: 600px;
        }
        
        .chat-messages {
            flex: 1;
            padding: 1.5rem;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
        }
        
        .message {
            max-width: 80%;
            display: flex;
            gap: 1rem;
        }
        
        .message.user {
            align-self: flex-end;
            flex-direction: row-reverse;
        }
        
        .message-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }
        
        .message-avatar.ai {
            background: linear-gradient(135deg, #10b981, #34d399);
            color: white;
        }
        
        .message-avatar.user {
            background: linear-gradient(135deg, #3b82f6, #60a5fa);
            color: white;
        }
        
        .message-content {
            background: var(--background-color);
            border-radius: 12px;
            padding: 1rem;
            box-shadow: 0 2px 8px var(--shadow-color);
        }
        
        .message.user .message-content {
            background: var(--primary-color);
            color: white;
        }
        
        .message-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 0.5rem;
        }
        
        .message-sender {
            font-weight: 600;
        }
        
        .message-time {
            font-size: 0.75rem;
            color: var(--text-secondary);
        }
        
        .message.user .message-time {
            color: rgba(255, 255, 255, 0.8);
        }
        
        /* Input Area */
        .chat-input-area {
            padding: 1.5rem;
            border-top: 1px solid var(--border-color);
            background: var(--card-background);
        }
        
        .input-group {
            display: flex;
            gap: 1rem;
        }
        
        .message-input {
            flex: 1;
            padding: 1rem;
            border: 1px solid var(--border-color);
            border-radius: 12px;
            background: var(--background-color);
            color: var(--text-primary);
            font-size: 0.875rem;
            resize: none;
            min-height: 60px;
        }
        
        .message-input:focus {
            outline: none;
            border-color: var(--primary-color);
        }
        
        /* Conversation History */
        .history-card {
            background: var(--card-background);
            border: 1px solid var(--border-color);
            border-radius: 16px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
        }
        
        .history-item {
            padding: 0.75rem;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-bottom: 0.5rem;
        }
        
        .history-item:hover {
            background: var(--hover-color);
        }
        
        .history-time {
            font-size: 0.75rem;
            color: var(--text-secondary);
            margin-bottom: 0.25rem;
        }
        
        .history-text {
            font-size: 0.875rem;
            color: var(--text-primary);
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }
    </style>
</head>
<body>
    <!-- Full Screen Navigation -->
    <nav class="navbar-full">
        <div class="navbar-container">
            <!-- Brand Logo -->
            <a href="index.html" class="navbar-brand">
                <i class="fas fa-chart-line"></i>
                <span>QuantAI</span>
            </a>
            
            <!-- Main Navigation Menu -->
            <div class="navbar-menu">
                <a href="index.html" class="nav-link">
                    <i class="fas fa-tachometer-alt"></i>
                    <span>Dashboard</span>
                </a>
                <a href="strategies.html" class="nav-link">
                    <i class="fas fa-robot"></i>
                    <span>Strategies</span>
                </a>
                <a href="ai-assistant.html" class="nav-link active">
                    <i class="fas fa-comments"></i>
                    <span>AI Assistant</span>
                </a>
                <a href="profile.html" class="nav-link">
                    <i class="fas fa-user"></i>
                    <span>Profile</span>
                </a>
            </div>
            
            <!-- Right Controls -->
            <div class="navbar-controls">
                <!-- Day/Night Mode Toggle -->
                <div class="theme-toggle" id="themeToggle">
                    <div class="theme-icon sun-icon">
                        <i class="fas fa-sun"></i>
                    </div>
                    <div class="theme-icon moon-icon">
                        <i class="fas fa-moon"></i>
                    </div>
                </div>
                
                <!-- User Info -->
                <div class="user-profile" onclick="toggleUserMenu()">
                    <div class="user-avatar">
                        Zhang
                    </div>
                    <div class="user-info">
                        <div class="user-name">Zhang Wei</div>
                        <div class="user-role">Gold Trader</div>
                    </div>
                    <i class="fas fa-chevron-down" style="font-size: 0.75rem;"></i>
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Content Area -->
    <div class="main-container">
        <!-- AI Assistant Header -->
        <div class="ai-header">
            <div class="ai-avatar">
                <i class="fas fa-robot"></i>
            </div>
            <div class="ai-info">
                <h1> QuantAI Intelligent Assistant</h1>
                <p>Your Exclusive Quantitative Trading Advisor 路 Based on GPT-4 Technology 路 Real-time Market Data Analysis</p>
                <div class="d-flex align-items-center gap-3 mt-2">
                    <span class="status-badge badge-success">
                        <i class="fas fa-circle"></i> Online
                    </span>
                    <span class="text-muted small">Response Time < 2s 路 Context Length: 4096 tokens</span>
                </div>
            </div>
        </div>

        <!-- Chat Interface -->
        <div class="chat-container">
            <!-- Left: Quick Questions and History -->
            <div>
                <!-- Quick Questions -->
                <div class="card">
                    <h3 class="mb-3">
                        <i class="fas fa-bolt text-warning"></i>
                        Quick Questions
                    </h3>
                    <div class="quick-questions">
                        <div class="question-card" onclick="askQuestion('Analyze current market trends and investment opportunities')">
                            <div class="question-icon bg-primary-light">
                                <i class="fas fa-chart-line"></i>
                            </div>
                            <div class="question-title">Market Analysis</div>
                            <div class="question-desc">Analyze current market trends and investment opportunities</div>
                        </div>
                        
                        <div class="question-card" onclick="askQuestion('Recommend quantitative strategies suitable for volatile markets')">
                            <div class="question-icon bg-success-light">
                                <i class="fas fa-robot"></i>
                            </div>
                            <div class="question-title">Strategy Recommendations</div>
                            <div class="question-desc">Recommend strategies for volatile markets</div>
                        </div>
                        
                        <div class="question-card" onclick="askQuestion('Explain the difference between Sharpe Ratio and Sortino Ratio')">
                            <div class="question-icon bg-warning-light">
                                <i class="fas fa-calculator"></i>
                            </div>
                            <div class="question-title">Indicator Explanation</div>
                            <div class="question-desc">Explain financial indicators and technical concepts</div>
                        </div>
                        
                        <div class="question-card" onclick="askQuestion('Help me write a simple mean reversion strategy code')">
                            <div class="question-icon bg-danger-light">
                                <i class="fas fa-code"></i>
                            </div>
                            <div class="question-title">Code Generation</div>
                            <div class="question-desc">Generate quantitative trading strategy code</div>
                        </div>
                    </div>
                </div>

                <!-- Conversation History -->
                <div class="history-card mt-3">
                    <h3 class="mb-3">
                        <i class="fas fa-history"></i>
                        Conversation History
                    </h3>
                    <div class="history-item" onclick="loadHistory(1)">
                        <div class="history-time">Today 14:30</div>
                        <div class="history-text">How to optimize backtest parameter settings?</div>
                    </div>
                    <div class="history-item" onclick="loadHistory(2)">
                        <div class="history-time">Today 11:15</div>
                        <div class="history-text">Explain the meaning and application scenarios of Sortino Ratio</div>
                    </div>
                    <div class="history-item" onclick="loadHistory(3)">
                        <div class="history-time">Yesterday 16:45</div>
                        <div class="history-text">Recommend strategy types suitable for current volatile markets</div>
                    </div>
                </div>
            </div>

            <!-- Right: Chat Area -->
            <div class="chat-area">
                <!-- Messages Area -->
                <div class="chat-messages" id="chatMessages">
                    <!-- AI Welcome Message -->
                    <div class="message">
                        <div class="message-avatar ai">
                            <i class="fas fa-robot"></i>
                        </div>
                        <div class="message-content">
                            <div class="message-header">
                                <div class="message-sender">QuantAI Assistant</div>
                                <div class="message-time">Just now</div>
                            </div>
                            <div>
                                Hello! I am your quantitative trading AI assistant. I can provide you with:
                                <ul class="mt-2 mb-0">
                                    <li> Market trend analysis and investment advice</li>
                                    <li> AI strategy recommendations and parameter optimization</li>
                                    <li> Quantitative code writing and debugging assistance</li>
                                    <li> Financial concept and technical indicator explanations</li>
                                    <li>锔 Backtest framework setup and optimization suggestions</li>
                                </ul>
                                <p class="mt-2 mb-0">How can I help you today?</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Input Area -->
                <div class="chat-input-area">
                    <div class="input-group">
                        <textarea class="message-input" id="messageInput" 
                                  placeholder="Type your question here... For example: Help me analyze Bitcoin trends, or recommend a strategy for current market"
                                  onkeydown="handleKeyDown(event)"></textarea>
                        <button class="btn-primary" onclick="sendMessage()" style="align-self: flex-end;">
                            <i class="fas fa-paper-plane"></i>
                        </button>
                    </div>
                    <div class="d-flex justify-content-between mt-2">
                        <small class="text-muted">
                            <i class="fas fa-keyboard"></i> Press Ctrl+Enter to send
                        </small>
                        <small class="text-muted">
                            <i class="fas fa-database"></i> Connected to real-time market data
                        </small>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="footer">
        <div class="footer-container">
            <div class="footer-brand">
                <i class="fas fa-chart-line"></i>
                <span>QuantAI Platform</span>
            </div>
            <div class="footer-info">
                <div>漏 2024 QuantAI 路 AI Assistant Demo</div>
                <div class="small mt-1">
                    <i class="fas fa-shield-alt me-1"></i>Disclaimer: AI suggestions are for reference only 路 
                    <i class="fas fa-brain ms-2 me-1"></i>Model Version: GPT-4 Turbo
                </div>
            </div>
        </div>
    </footer>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    
    <script>
        // Theme Management
        let currentTheme = localStorage.getItem('quantai-theme') || 'light';
        
        // Chat State
        let chatHistory = [
            {
                role: 'assistant',
                content: 'Hello! I am your quantitative trading AI assistant. I can provide you with:\n\n Market trend analysis and investment advice\n AI strategy recommendations and parameter optimization\n Quantitative code writing and debugging assistance\n Financial concept and technical indicator explanations\n锔 Backtest framework setup and optimization suggestions\n\nHow can I help you today?'
            }
        ];
        
        // Initialize Theme
        function initTheme() {
            document.documentElement.setAttribute('data-theme', currentTheme);
            updateThemeToggle();
        }
        
        // Toggle Theme
        function toggleTheme() {
            currentTheme = currentTheme === 'light' ? 'dark' : 'light';
            document.documentElement.setAttribute('data-theme', currentTheme);
            localStorage.setItem('quantai-theme', currentTheme);
            updateThemeToggle();
            showNotification(`Switched to ${currentTheme === 'light' ? 'light' : 'dark'} mode`);
        }
        
        // Update Theme Toggle Button Status
        function updateThemeToggle() {
            const toggle = document.getElementById('themeToggle');
            if (currentTheme === 'dark') {
                toggle.style.background = 'rgba(255, 255, 255, 0.3)';
            } else {
                toggle.style.background = 'rgba(255, 255, 255, 0.2)';
            }
        }
        
        // Send Message
        function sendMessage() {
            const input = document.getElementById('messageInput');
            const message = input.value.trim();
            
            if (!message) return;
            
            // Add user message
            addMessage('user', message);
            chatHistory.push({ role: 'user', content: message });
            input.value = '';
            
            // Show AI typing indicator
            showTypingIndicator();
            
            // Simulate AI response
            setTimeout(() => {
                removeTypingIndicator();
                const aiResponse = getAIResponse(message);
                addMessage('assistant', aiResponse);
                chatHistory.push({ role: 'assistant', content: aiResponse });
                scrollToBottom();
            }, 1500);
        }
        
        // Quick Question
        function askQuestion(question) {
            document.getElementById('messageInput').value = question;
            sendMessage();
        }
        
        // Add Message to Chat Interface
        function addMessage(role, content) {
            const messagesContainer = document.getElementById('chatMessages');
            const now = new Date().toLocaleTimeString('en-US', { 
                hour: '2-digit', 
                minute: '2-digit' 
            });
            
            const messageHtml = `
                <div class="message ${role}">
                    <div class="message-avatar ${role}">
                        <i class="fas fa-${role === 'user' ? 'user' : 'robot'}"></i>
                    </div>
                    <div class="message-content">
                        <div class="message-header">
                            <div class="message-sender">
                                ${role === 'user' ? 'You' : 'QuantAI Assistant'}
                            </div>
                            <div class="message-time">${now}</div>
                        </div>
                        <div>${formatMessage(content)}</div>
                    </div>
                </div>
            `;
            
            messagesContainer.insertAdjacentHTML('beforeend', messageHtml);
            scrollToBottom();
        }
        
        // Format Message Content
        function formatMessage(content) {
            // Convert line breaks to <br>
            return content.replace(/\n/g, '<br>');
        }
        
        // Show Typing Indicator
        function showTypingIndicator() {
            const messagesContainer = document.getElementById('chatMessages');
            
            const typingHtml = `
                <div class="message" id="typingIndicator">
                    <div class="message-avatar ai">
                        <i class="fas fa-robot"></i>
                    </div>
                    <div class="message-content">
                        <div class="message-header">
                            <div class="message-sender">QuantAI Assistant</div>
                            <div class="message-time">Typing...</div>
                        </div>
                        <div class="d-flex align-items-center">
                            <div class="typing-dot"></div>
                            <div class="typing-dot"></div>
                            <div class="typing-dot"></div>
                        </div>
                    </div>
                </div>
            `;
            
            messagesContainer.insertAdjacentHTML('beforeend', typingHtml);
            scrollToBottom();
        }
        
        // Remove Typing Indicator
        function removeTypingIndicator() {
            const indicator = document.getElementById('typingIndicator');
            if (indicator) {
                indicator.remove();
            }
        }
        
        // Get AI Response
        function getAIResponse(question) {
            const responses = {
                'Analyze current market trends': 'Based on current market data, the CSI 300 Index is in a volatile upward channel, with support at 3800 points and resistance at 4200 points. Recommendations:\n\n1. Tech sector oversold rebound opportunities\n2. Long-term allocation in new energy industry chain\n3. Defensive allocation in consumer sector\n\nShort-term focus on trading volume changes, medium-term outlook positive for policy-supported industries.',
                'Recommend quantitative strategies suitable for volatile markets': 'Recommended strategies for volatile markets:\n\n1. **Mean Reversion Strategy**: Using Bollinger Bands or RSI indicators, suitable for range-bound markets\n2. **Grid Trading Strategy**: Setting fixed price grid, suitable for range volatility\n3. **Volatility Strategy**: Based on options or futures volatility trading\n\nRecommended setting narrow stop-loss range and smaller position sizes.',
                'Explain the difference between Sharpe Ratio and Sortino Ratio': '**Sharpe Ratio** = (Return - Risk-free rate) / Total volatility, measures excess return per unit of total risk.\n\n**Sortino Ratio** = (Return - Risk-free rate) / Downside volatility, considers only unfavorable volatility, better for evaluating risk-averse investors.\n\nThe main difference is in the denominator: Sharpe uses total volatility, Sortino uses only downside volatility.',
                'Help me write a simple mean reversion strategy code': 'Here is a Python example of a Bollinger Bands mean reversion strategy:\n\n```python\nimport pandas as pd\nimport numpy as np\n\ndef mean_reversion_strategy(data, window=20, num_std=2):\n    """Bollinger Bands Mean Reversion Strategy"""\n    # Calculate Bollinger Bands\n    data[\'sma\'] = data[\'close\'].rolling(window).mean()\n    data[\'std\'] = data[\'close\'].rolling(window).std()\n    data[\'upper\'] = data[\'sma\'] + num_std * data[\'std\']\n    data[\'lower\'] = data[\'sma\'] - num_std * data[\'std\']\n    \n    # Generate trading signals\n    data[\'signal\'] = 0\n    data.loc[data[\'close\'] < data[\'lower\'], \'signal\'] = 1  # Buy signal\n    data.loc[data[\'close\'] > data[\'upper\'], \'signal\'] = -1 # Sell signal\n    \n    return data\n```'
            };
            
            // Check for predefined responses
            for (const [key, value] of Object.entries(responses)) {
                if (question.includes(key)) {
                    return value;
                }
            }
            
            // Default response
            return `I have received your question: "${question}".\n\nAs your quantitative trading AI assistant, I can help analyze from the following perspectives:\n\n1. **Market Analysis Perspective**: Combined with current technical indicators and fundamental data\n2. **Strategy Design Perspective**: Considering risk management, position sizing, and capital management\n3. **Code Implementation Perspective**: Providing Python implementation solutions and optimization suggestions\n\nPlease tell me which aspect you\'re more interested in, or I can provide you with comprehensive advice?`;
        }
        
        // Scroll to Bottom
        function scrollToBottom() {
            const messagesContainer = document.getElementById('chatMessages');
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }
        
        // Keyboard Shortcuts
        function handleKeyDown(event) {
            if (event.ctrlKey && event.key === 'Enter') {
                event.preventDefault();
                sendMessage();
            }
        }
        
        // Load Conversation History
        function loadHistory(id) {
            showNotification('Loading conversation history...', 'info');
        }
        
        // Toggle User Menu
        function toggleUserMenu() {
            showNotification('User menu feature under development...', 'info');
        }
        
        // Show Notification
        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.className = `alert alert-${type} alert-dismissible fade show position-fixed`;
            notification.style.cssText = `
                top: 90px;
                right: 20px;
                z-index: 9999;
                min-width: 300px;
                box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
                border: none;
                border-radius: 12px;
                animation: slideIn 0.3s ease;
                background: ${currentTheme === 'dark' ? '#1e293b' : 'white'};
                color: ${currentTheme === 'dark' ? '#f1f5f9' : '#1e293b'};
                border-left: 4px solid ${type === 'success' ? '#10b981' : type === 'warning' ? '#f59e0b' : type === 'danger' ? '#ef4444' : '#3b82f6'};
            `;
            
            const icons = {
                'success': { icon: 'check-circle', color: '#10b981' },
                'warning': { icon: 'exclamation-triangle', color: '#f59e0b' },
                'danger': { icon: 'times-circle', color: '#ef4444' },
                'info': { icon: 'info-circle', color: '#3b82f6' }
            };
            
            notification.innerHTML = `
                <div class="d-flex align-items-center">
                    <div class="me-3">
                        <i class="fas fa-${icons[type].icon}" style="color: ${icons[type].color}"></i>
                    </div>
                    <div>${message}</div>
                </div>
                <button type="button" class="btn-close" onclick="this.parentElement.remove()"></button>
            `;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                if (notification.parentNode) {
                    notification.remove();
                }
            }, 3000);
        }
        
        // Initialize Page
        document.addEventListener('DOMContentLoaded', function() {
            initTheme();
            document.getElementById('themeToggle').addEventListener('click', toggleTheme);
            scrollToBottom();
            
            // Add typing animation styles
            const style = document.createElement('style');
            style.textContent = `
                .typing-dot {
                    width: 8px;
                    height: 8px;
                    background: ${currentTheme === 'dark' ? '#94a3b8' : '#64748b'};
                    border-radius: 50%;
                    margin: 0 2px;
                    animation: typing 1.4s infinite;
                }
                
                .typing-dot:nth-child(2) { animation-delay: 0.2s; }
                .typing-dot:nth-child(3) { animation-delay: 0.4s; }
                
                @keyframes typing {
                    0%, 60%, 100% { transform: translateY(0); opacity: 0.4; }
                    30% { transform: translateY(-5px); opacity: 1; }
                }
            `;
            document.head.appendChild(style);
        });
    </script>
</body>
</html>